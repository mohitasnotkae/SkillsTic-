<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>skillsTic ‚Äì No Draw Tic Tac Toe</title>

<style>
/* ===== GLOBAL ===== */
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top,#3b0066,#12001f);
  color:#fff;
}

/* ===== TERMS SCREEN ===== */
#termsScreen{
  position:fixed;
  inset:0;
  background: radial-gradient(circle at top,#2a003f,#12001f);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.termsBox{
  max-width:420px;
  background:linear-gradient(135deg,#2a003f,#3b0066);
  border:1px solid gold;
  border-radius:16px;
  padding:20px;
}
.termsBox h2{
  margin-top:0;
  color:gold;
  text-align:center;
}
.termsBox ul{
  font-size:14px;
  line-height:1.6;
  padding-left:18px;
}
.termsBox label{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:10px;
  font-size:14px;
}
.termsBtn{
  width:100%;
  margin-top:15px;
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:20px;
  background:#8e2de2;
  color:#fff;
}

/* ===== CLEAN WALLET HEADER FIX ===== */

.topBar{
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background: linear-gradient(90deg,#4b0082,#2a003f);
}

.logo{
  font-size:22px;
  font-weight:bold;
}

.walletBox{
  display:flex;
  align-items:center;
  gap:10px;
}

.balance{
  background:#2b0140;
  border:1px solid gold;
  padding:6px 14px;
  border-radius:20px;
  color:gold;
  font-weight:bold;
}

.depositBtn{
  background:#00c853;
  color:black;
  border:none;
  padding:8px 16px;
  border-radius:18px;
  font-weight:bold;
  cursor:pointer;
}

.secondaryActions{
  display:flex;
  justify-content:flex-end;
  gap:12px;
  padding:8px 15px;
}

.withdrawBtn{
  background:transparent;
  border:1px solid #ff5252;
  color:#ff5252;
  padding:6px 14px;
  border-radius:16px;
  cursor:pointer;
}

.logoutBtn{
  background:none;
  border:none;
  color:#ff6b6b;
  font-size:14px;
  cursor:pointer;
}

/* ===== LOBBY ===== */
.container{
  padding:15px;
  margin-top:10px;
}.card{
  border:1px solid #d4af37;
  border-radius:15px;
  padding:15px;
  margin-bottom:15px;
  background: linear-gradient(135deg,#2a003f,#3b0066);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.card .info{line-height:1.6;}
.joinBtn{
  background:#8e2de2;
  border:none;
  color:white;
  padding:10px 18px;
  border-radius:20px;
  font-size:16px;
}

/* ===== GAME ===== */
#game{
  text-align:center;
}

/* ===== HIDE UTILITY ===== */
.hidden{
  display:none !important;
}
.timer{
  font-size:20px;
  margin-top:10px;
  color:#ffcc00;
}
.board{
  display:grid;
  grid-template-columns:repeat(3,90px);
  gap:10px;
  justify-content:center;
  margin-top:20px;
}
.cell{
  width:90px;
  height:90px;
  background:white;
  color:black;
  font-size:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
}
.cell.win{
  background:#00ffcc;
  box-shadow:0 0 15px #00ffcc;
}
.status{
  margin-top:15px;
  font-size:18px;
  white-space:pre-line;
}
.btnRow{
  margin-top:20px;
}
.actionBtn{
  background:#444;
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:20px;
  margin:5px;
}
</style>
</head>

<body>

<!-- ===== TERMS PAGE ===== -->
<div id="termsScreen">
  <div class="termsBox">
    <h2>Terms & Conditions</h2>
    <ul>
      <li>You must be <b>18 years or older</b>.</li>
      <li>This is a <b>skill-based game</b>, not gambling.</li>
      <li>Wallet shown is <b>demo / virtual</b>.</li>
      <li>No refunds for unfinished games.</li>
      <li>Developer decision is final.</li>
    </ul>

    <label>
      <input type="checkbox" id="ageCheck">
      I confirm that I am 18+ years old
    </label>

    <button class="termsBtn" onclick="acceptTerms()">Agree & Continue</button>
  </div>
</div>
<!-- ===== LOGIN / SIGNUP SCREEN ===== -->
<div id="loginScreen" style="
  position:fixed;
  inset:0;
  background: radial-gradient(circle at top,#2a003f,#12001f);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9998;
">
  <div class="termsBox">
    <h2>Login / Sign Up</h2>

    <div id="mobileStep">
      <input type="tel" id="mobile" placeholder="Enter Mobile Number"
        style="width:100%;padding:12px;border-radius:10px;border:none;">
      <button class="termsBtn" onclick="sendOTP()">Send OTP</button>
    </div>

    <div id="otpStep" style="display:none;">
      <p style="color:#ffcc00;text-align:center;">
        Demo OTP: <b>123456</b>
      </p>
      <input type="number" id="otp" placeholder="Enter OTP"
        style="width:100%;padding:12px;border-radius:10px;border:none;">
      <button class="termsBtn" onclick="verifyOTP()">Verify & Continue</button>
    </div>
  </div>
</div>

<!-- ===== APP ===== -->
<!-- ===== CLEAN HEADER ===== -->
<div class="topBar">
  <div class="logo">skillsTic</div>

  <div class="walletBox">
    <div class="balance">‚Çπ <span id="wallet">0</span></div>
    <button class="depositBtn" onclick="goDeposit()">+ Deposit</button>
  </div>
</div>

<div class="secondaryActions">
  <button class="withdrawBtn" onclick="goWithdraw()">Withdraw</button>
  <button class="logoutBtn" onclick="logout()">Logout</button>
</div>

<div class="container" id="contestList">

  <div class="card">
  <div class="info">
    <b>Online PvP Match</b><br>
    Entry: ‚Çπ49<br>
    Real Player vs Real Player
  </div>
  <button class="joinBtn" onclick="
    contestList.classList.add('hidden');
    createRoom();
  ">
    Create Match
  </button>
</div>
<div class="card">
  <div class="info">
    <b>üèÜ Grand League</b><br>
    Entry: ‚Çπ36<br>
    Prize Pool: ‚Çπ25.92 Lakh<br>
    ü•á Top Win: 36%
  </div>
  <button class="joinBtn" onclick="joinGrandLeague()">
    Join Contest
  </button>
</div>

  <div class="card">
    <div class="info">
      <b>Join Match</b><br>
      Enter Room ID
    </div>
    <input id="roomInput"
      placeholder="ROOM ID"
      style="padding:8px;border-radius:8px;border:none;">
    <button class="joinBtn" onclick="joinRoom()">Join</button>
  </div>

</div>

<div id="game" class="hidden">
  <h2>Tic Tac Toe</h2>
<div id="turn" style="margin-top:8px;color:#ffcc00;">Your Turn</div>
  <div class="timer">‚è± Time Left: <span id="time">15</span>s</div>
  <div class="board" id="board"></div>
  <div class="status" id="status"></div>

  <div class="btnRow">
    <button class="actionBtn" onclick="restartGame()">Restart</button>
    <button class="actionBtn" onclick="backToLobby()">Back to Lobby</button>
  </div>
</div>

<script>
/* ===== TERMS + LOGIN LOGIC ===== */

function acceptTerms(){
  if(!document.getElementById("ageCheck").checked){
    alert("You must confirm 18+");
    return;
  }
  localStorage.setItem("skillsTic_termsAccepted","yes");
  document.getElementById("termsScreen").style.display="none";
  document.getElementById("loginScreen").style.display="flex";
}

if(localStorage.getItem("skillsTic_termsAccepted")==="yes"){
  document.getElementById("termsScreen").style.display="none";
  if(localStorage.getItem("skillsTic_loggedIn")!=="yes"){
    document.getElementById("loginScreen").style.display="flex";
  }
}

function sendOTP(){
  const m=document.getElementById("mobile").value;
  if(m.length<10){
    alert("Enter valid mobile number");
    return;
  }
  document.getElementById("mobileStep").style.display="none";
  document.getElementById("otpStep").style.display="block";
}

function verifyOTP(){
  if(document.getElementById("otp").value!=="123456"){
    alert("Invalid OTP");
    return;
  }
  localStorage.setItem("skillsTic_loggedIn","yes");
  document.getElementById("loginScreen").style.display="none";
}
/* ===== GRAND LEAGUE CONFIG ===== */

const grandLeague = {
  entryFee: 36,
  maxPlayers: 100000,
  joined: 0,
  startTime: "20:00",
  endTime: "22:00",
  matchesPerUser: 10,
  isLive: false,
  prizePool: 2592000, // 25.92 lakh
  topWinPercent: 36
};

let glMatchesLeft = 0;
let glPoints = 0;
function joinGrandLeague(){
  if(wallet < grandLeague.entryFee){
    alert("Not enough balance");
    return;
  }

  wallet -= grandLeague.entryFee;
  updateWallet();

  grandLeague.joined++;
  localStorage.setItem("joinedGL","yes");

  alert(
    "Joined Grand League!\n" +
    "Starts at 8:00 PM\n" +
    "Matches: " + grandLeague.matchesPerUser
  );
}
// ===== AUTO START & END GRAND LEAGUE =====
setInterval(()=>{
  const now = new Date();
  const time =
    String(now.getHours()).padStart(2,"0") + ":" +
    String(now.getMinutes()).padStart(2,"0");

  if(time === grandLeague.startTime && !grandLeague.isLive){
    startGrandLeague();
  }

  if(time === grandLeague.endTime && grandLeague.isLive){
    endGrandLeague();
  }
}, 30000);
function startGrandLeague(){
  if(localStorage.getItem("joinedGL") !== "yes") return;

  grandLeague.isLive = true;
  glMatchesLeft = grandLeague.matchesPerUser;
  glPoints = 0;

  document.getElementById("contestList").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");

  startGame(); // function already exists in script.js
}
function onGrandLeagueMatchEnd(result, timeLeft){
  if(!grandLeague.isLive) return;

  if(result === "win"){
    glPoints += 10;
    if(timeLeft > 10) glPoints += 5;
  }

  glMatchesLeft--;

  if(glMatchesLeft > 0){
    startGame();
  }else{
    saveGrandLeagueScore();
  }
}

function saveGrandLeagueScore(){
  let scores = JSON.parse(localStorage.getItem("glScores")) || [];

  scores.push({
    user: "player",
    score: glPoints
  });

  localStorage.setItem("glScores", JSON.stringify(scores));

  alert(
    "Grand League Matches Finished\n" +
    "Your Score: " + glPoints
  );
}

function endGrandLeague(){
  grandLeague.isLive = false;

  let scores = JSON.parse(localStorage.getItem("glScores")) || [];
  scores.sort((a,b)=>b.score-a.score);

  const topPrize =
    Math.floor(grandLeague.prizePool * (grandLeague.topWinPercent / 100));

  alert(
    "üèÜ Grand League Ended\n" +
    "Rank 1 Prize: ‚Çπ" + topPrize
  );

  localStorage.removeItem("joinedGL");
}

</script>
<!-- ===== WINNER ANNOUNCEMENT POPUP ===== -->
<div id="winnerPopup" class="hidden"
style="
position:fixed;
inset:0;
background:rgba(0,0,0,0.7);
display:flex;
align-items:center;
justify-content:center;
z-index:9999;
">
  <div style="
    background:linear-gradient(135deg,#2a003f,#3b0066);
    border:2px solid gold;
    border-radius:18px;
    padding:25px;
    text-align:center;
    width:300px;
    color:white;
  ">
    <h2 id="winnerTitle" style="color:#00ffcc;">RESULT</h2>

    <p id="winnerDetails" style="white-space:pre-line;margin-top:10px;"></p>

    <button onclick="closeWinnerPopup()"
    style="
      margin-top:15px;
      padding:10px 20px;
      border:none;
      border-radius:20px;
      background:#00c853;
      font-weight:bold;
      cursor:pointer;
    ">
      OK
    </button>
  </div>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
  const socket = io("https://skillstic.onrender.com");
</script>

<script src="script.js"></script>

</body>
</html>
